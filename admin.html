<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Administración de Usuarios</title>
<style>
body { font-family: Arial, sans-serif; padding: 20px; }
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
button { padding: 5px 10px; margin: 2px; }
input[type="text"] { width: 150px; }
</style>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
</head>
<body>
<h2>Gestión de Usuarios</h2>

<table id="userTable">
<tr><th>Usuario</th><th>Contraseña</th><th>Páginas</th><th>Acciones</th></tr>
</table>

<h3>Añadir nuevo usuario</h3>
  <h4>Paginas: Multi, SS, Vote</h4>
<input type="text" id="newUser" placeholder="Usuario">
<input type="text" id="newPass" placeholder="Contraseña">
<input type="text" id="newPages" placeholder="Páginas separadas por coma">
<button onclick="addUser()">Añadir usuario</button>

<br><br>
<button onclick="logout()">Cerrar sesión</button>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyARrsVZ2LboEe5MblE8GKXVnas-zHB4k5I",
  authDomain: "et-accounts.firebaseapp.com",
  databaseURL: "https://et-accounts-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "et-accounts",
  storageBucket: "et-accounts.firebasestorage.app",
  messagingSenderId: "1006439185867",
  appId: "1:1006439185867:web:ee9221150be923340e4a4e"
};

firebase.initializeApp(firebaseConfig);
const database = firebase.database();
const usersRef = database.ref('users');

window.onload = async function() {
    const currentUser = localStorage.getItem("currentUser");
    if(currentUser !== "admin") {
        alert("Acceso denegado");
        window.location.href = "index.html";
    } else {
        renderUsers();
    }
}

function renderUsers() {
    const table = document.getElementById("userTable");
    table.innerHTML = '<tr><th>Usuario</th><th>Contraseña</th><th>Páginas</th><th>Acciones</th></tr>';
    usersRef.once('value', snapshot => {
        snapshot.forEach(childSnap => {
            const user = childSnap.key;
            if(user === "admin") return;
            const data = childSnap.val();
            const row = table.insertRow();
            row.insertCell(0).textContent = user;
            row.insertCell(1).textContent = atob(data.password);
            row.insertCell(2).textContent = data.pages.join(", ");
            const actions = row.insertCell(3);

            const editBtn = document.createElement("button");
            editBtn.textContent = "Editar";
            editBtn.onclick = () => editUser(user, data);
            actions.appendChild(editBtn);

            const delBtn = document.createElement("button");
            delBtn.textContent = "Eliminar";
            delBtn.onclick = () => deleteUser(user);
            actions.appendChild(delBtn);
        });
    });
}

function addUser() {
    const username = document.getElementById("newUser").value.trim();
    const password = document.getElementById("newPass").value.trim();
    const pages = document.getElementById("newPages").value.split(",").map(p => p.trim()).filter(p => p);
    if(!username || !password) { alert("Usuario y contraseña obligatorios"); return; }
    usersRef.child(username).set({password: btoa(password), pages});
    renderUsers();
    document.getElementById("newUser").value = "";
    document.getElementById("newPass").value = "";
    document.getElementById("newPages").value = "";
}

function editUser(user, data) {
    const newPass = prompt("Nueva contraseña para " + user, atob(data.password));
    if(newPass === null) return;
    const newPages = prompt("Páginas separadas por coma", data.pages.join(", "));
    if(newPages === null) return;
    usersRef.child(user).update({password: btoa(newPass), pages: newPages.split(",").map(p => p.trim())});
    renderUsers();
}

function deleteUser(user) {
    if(confirm("¿Eliminar usuario " + user + "?")) {
        usersRef.child(user).remove();
        renderUsers();
    }
}

function logout() {
    localStorage.removeItem("currentUser");
    window.location.href = "index.html";
}
</script>
</body>
</html>

